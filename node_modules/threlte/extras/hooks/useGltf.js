import { createEventDispatcher } from 'svelte';
import { writable } from 'svelte/store';
import { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader';
import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader';
import { useLoader } from '../../hooks/useLoader';
import { buildSceneGraph } from '../../lib/buildSceneGraph';
createEventDispatcher;
export const useGltf = (url, options) => {
    const gltf = writable(undefined);
    const loader = useLoader(GLTFLoader, () => new GLTFLoader());
    if (options?.useDraco) {
        const dracoDecoderPath = typeof options.useDraco === 'string'
            ? options.useDraco
            : 'https://www.gstatic.com/draco/versioned/decoders/1.4.3/';
        const dracoLoader = useLoader(DRACOLoader, () => new DRACOLoader().setDecoderPath(dracoDecoderPath));
        loader.setDRACOLoader(dracoLoader);
    }
    loader.load(url, (data) => {
        if (data.scene)
            Object.assign(data, buildSceneGraph(data.scene));
        gltf.set(data);
    });
    return {
        gltf
    };
};
